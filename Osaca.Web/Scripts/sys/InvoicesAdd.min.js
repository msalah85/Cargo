var pageManager=pageManager||{},pageManager=function(){"use strict";var n=commonManger.getUrlVars().id,i=function(){h();r()},r=function(){$("#ExpenseID").change(function(){l($(this).val())});$("#btnAddAmount").click(function(n){n.preventDefault();var t=$("#ExpenseID").val();t!==""?c():commonManger.showMessage("Required fields","Please enter all required fields.")});$("#listItems tbody").delegate("tr button.remove","click",function(n){n.preventDefault();var i=$(this).closest("tr");i&&i.css({transition:"background-color 1s","background-color":"red"}).fadeOut("slow").promise().done(function(){i.remove();t()})});$("#listItems tbody").delegate('tr input[type="number"]',"keyup",function(){t()});$("#SaveAll").click(function(n){n.preventDefault();u()});$("#addModal").on("shown.bs.modal",function(){$("#ExpenseID").val("");$("#Cost,#Amount").val("0.0")})},u=function(){if(e()){var n=$("#listItems tbody tr").map(function(n,t){var i=$(t).find("td:eq(0)").attr("data-inv-details-id");return(i?i:0)+",0,"+$(t).find("td:eq(0)").text()+","+numeral().unformat($(t).find("td:eq(2) input").val())+","+numeral().unformat($(t).find("td:eq(3) input").val())}).get(),t=[$("#InvoiceID").val(),$("#ClientID").val(),$("#AddDate").val(),0,numeral().unformat($("#TotalAmount").text()),numeral().unformat($("#TotalProfit").text()),$("#ContainerNo").val(),$("#DeclarationNo").val(),$("#Notes").val()];f(["InvoiceID","ClientID","AddDate","Deleted","TotalAmount","Profit","ContainerNo","DeclarationNo","Notes"],t,["InvoiceDetailsID","InvoiceID","ExpenseID","Cost","Amount"],n)}else commonManger.showMessage("Data required","Please enter all mandatory fields.")},f=function(n,t,i,r){var u={fieldsMaster:n,valuesMaster:t,fieldsDetails:i,valuesDetails:r};dataService.callAjax("Post",JSON.stringify(u),"InvoiceAdd.aspx/SaveDataMasterDetails",o,commonManger.errorException)},e=function(){var t=!0,n={client:$("#ClientID").val(),gridLength:$("#listItems tbody tr").length,date:$("#AddDate").val(),container:$("#AddDate").val(),declaration:$("#AddDate").val()};return(n.client===""||n.gridLength<=0||n.date===""||n.container===""||n.declaration==="")&&(t=!1),t},o=function(n){n=n.d;n.Status?window.location.href="InvoicePrint.aspx?id="+n.ID:commonManger.showMessage("Error!","Error occured!:"+n.message)},s=function(i){var r=$.parseXML(i.d),u=$.xml2json(r).list,f=$.xml2json(r).list1,e=$.xml2json(r).list2,h=$.xml2json(r).list3,o,s;if(u){o=$(u).map(function(n,t){return $("<option />").val(t.ExpenseID).text(t.ExpenseName)}).get();$("#ExpenseID").append(o).trigger("chosen:updated").trigger("liszt:updated");var c=n?h:u,l=$(c).map(function(n,t){return $('<tr><td data-inv-details-id="'+(t.InvoiceDetailsID?t.InvoiceDetailsID:0)+'">'+t.ExpenseID+"<\/td><td>"+t.ExpenseName+'<\/td>                             <td><input type="number" value="'+numeral(t.Cost?t.Cost:t.DefaultValue).format("0.0")+'" /><\/td><td><input type="number" value="'+numeral(t.Amount?t.Amount:t.DefaultValue).format("0.0")+'" /><\/td>                             <td><button class="btn btn-minier btn-danger remove" data-rel="tooltip" data-placement="top" data-original-title="Delete" title="Delete"><i class="fa fa-remove icon-only"><\/i><\/button><\/td><\/tr>')}).get(),a=$("#listItems tbody");a.append(l);t()}f&&(s=$(f).map(function(n,t){return $("<option />").val(t.ClientID).text(t.ClientName)}).get(),$("#ClientID").append(s).trigger("chosen:updated").trigger("liszt:updated"));e&&($.each(e,function(n,t){$("#masterForm #"+n).val(t)}),$(".date-picker").text(function(){return commonManger.formatJSONDateCal($(this).text())}))},h=function(){var t="Invoices_Properties",i=n?{actionName:t,value:n}:{actionName:t};dataService.callAjax("Post",JSON.stringify(i),sUrl+"GetData"+(n?"":"Direct"),s,commonManger.errorException)},c=function(){var n={ExpenseID:$("#ExpenseID").val(),ExpenseName:$("#ExpenseID option:selected").text(),Cost:$("#Cost").val(),Amount:$("#Amount").val()},u=$("#listItems tbody"),r,i;n&&(r=$(n).map(function(n,t){return $('<tr><td data-inv-details-id="'+(t.InvoiceDetailsID?t.InvoiceDetailsID:0)+'">'+t.ExpenseID+"<\/td><td>"+t.ExpenseName+'<\/td>                             <td><input type="number" value="'+numeral(t.Cost).format("0.0")+'" /><\/td><td><input type="number" value="'+numeral(t.Amount).format("0.0")+'" /><\/td>                             <td><button class="btn btn-minier btn-danger remove" data-rel="tooltip" data-placement="top" data-original-title="Delete" title="Delete"><i class="fa fa-remove icon-only"><\/i><\/button><\/td><\/tr>')}).get(),i=!1,$("#listItems tbody tr").each(function(){$(this).children("td:eq(0)").text()===n.ExpenseID&&(i=!0)}),i?commonManger.showMessage("Data Exists:","Data already exists before."):(u.append(r),t()));$(".modal").modal("hide")},t=function(){var t=0,n=0;$("#listItems tbody tr").each(function(){try{var i=$(this).find("td:eq(2) input").val(),r=$(this).find("td:eq(3) input").val();t+=numeral().unformat(i&&!isNaN(i)?i:0)*1;n+=numeral().unformat(r&&!isNaN(r)>0?r:0)*1}catch(u){console.log(u)}});$("#TotalAmount").text(numeral(n).format("0,0.0"));$("#TotalProfit").text(numeral(n-t).format("0,0.0"));n>0?$("#SaveAll").removeClass("hidden"):$("#SaveAll").addClass("hidden")},a=function(){$("#aspnetForm")[0].reset();$("#listItems tbody").html("");$("#TotalAmountDhs").text("0")},l=function(n){var t={actionName:"Expenses_SelectRow",value:n},i=function(n){var i=$.parseXML(n.d),t=$.xml2json(i).list;t&&($("#Cost").val(numeral(t.DefaultValue).format("0.00")),$("#Amount").val(numeral(t.DefaultValue).format("0.00")))};dataService.callAjax("Post",JSON.stringify(t),sUrl+"GetData",i,commonManger.errorException)};return{Init:i}}();